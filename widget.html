<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Entre â€¢ Link de IndicaÃ§Ã£o</title>
<meta name="color-scheme" content="light only" />
<style>
  /* ===== Base & reset ===== */
  *,*::before,*::after{ box-sizing:border-box; }

  :root{
    --panel:#ffffff;
    --card:#9D4EDD;
    --primary:#5A189A;
    --icon:#FF9000;
    --text:#2b2b2b;
    --muted:rgba(0,0,0,.60);
    --input-bg:#F3E6FF;
    --input-br:#E6D4FF;

    /* safe-areas + clamp para nÃ£o colar nas bordas em telas muito estreitas */
    --pad-x: clamp(12px, 4vw, 20px);
    --pad-y: clamp(10px, 3vh, 16px);
    --safe-l: max(var(--pad-x), env(safe-area-inset-left));
    --safe-r: max(var(--pad-x), env(safe-area-inset-right));
    --safe-t: max(var(--pad-y), env(safe-area-inset-top));
    --safe-b: max(var(--pad-y), env(safe-area-inset-bottom));
  }

  html,body{ height:100%; }
  body{
    margin:0;
    background:transparent; /* deixa o fundo do Framer aparecer */
    font-family:"Uncut Sans", Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    overflow-x:hidden; /* nada de scroll lateral */
  }

  /* acolchoado que impede o card de encostar na borda do iFrame */
  .wrapper{
    padding: var(--safe-t) var(--safe-r) var(--safe-b) var(--safe-l);
  }

  .panel{
    width:100%;
    max-width:560px;
    background:var(--panel);
    border-radius:24px;
    padding:28px;
    box-shadow:0 10px 40px rgba(0,0,0,.18);
    margin:0;
    overflow-wrap:anywhere;
  }

  /* micro-ajustes para telas bem estreitas */
  @media (max-width: 380px){
    .panel{ padding:18px; border-radius:16px; }
    .title{ font-size:22px; }
  }

  .title{
    color:var(--primary);
    margin:4px 0 12px;
    font-size:clamp(22px,2.8vw,30px);
    font-weight:900;
  }
  .subtitle{ margin:0 0 18px; color:var(--muted); font-size:14px; line-height:1.5; }

  .label{ display:block; margin:12px 0 6px; color:#4b3a86; font-weight:750; }

  .input{
    display:block; width:100%;
    padding:14px 14px;
    border:2px solid var(--input-br);
    border-radius:12px; outline:none; font-size:16px;
    background:var(--input-bg); color:var(--text);
  }
  .input::placeholder{ color:rgba(0,0,0,.35); }
  .input:focus{ border-color:#cbb2ff; box-shadow:0 0 0 3px rgba(90,24,154,.10); }

  .btn{
    margin-top:18px; width:100%; padding:14px 16px; border:0; border-radius:12px;
    background:linear-gradient(135deg, var(--primary), #7b2cbf);
    color:#fff; font-weight:900; font-size:16px; cursor:pointer;
  }
  .btn:hover{ filter:brightness(1.05); }

  /* ===== Card de dados ===== */
  .card{
    margin-top:6px; padding:18px; border-radius:20px; background:var(--card); color:#fff;
    box-shadow:0 8px 30px rgba(0,0,0,.1);
    opacity:0; transform:translateY(20px);
    transition:opacity .4s ease, transform .4s ease;
    overflow-wrap:anywhere;
  }
  .card.visible{ opacity:1; transform:translateY(0); }
  .card-title{ margin:0 0 8px; font-size:18px; font-weight:900; letter-spacing:.2px; }
  .row{ display:flex; justify-content:space-between; gap:12px; padding:10px 0; border-bottom:1px dashed rgba(255,255,255,.25); font-size:15px; }
  .row:last-child{ border-bottom:0; }
  .k{ opacity:.9; font-weight:750; }
  .v a{ color:#fff; text-decoration:underline; word-break:break-all; }

  .share-ctas{ margin-top:14px; display:flex; gap:10px; flex-wrap:wrap; }

  /* WhatsApp VERDE */
  .share-btn.whatsapp{
    display:inline-flex; align-items:center; gap:10px;
    background:#25D366; color:#fff;
    border:2px solid #25D366; border-radius:12px;
    padding:10px 14px; font-weight:800; cursor:pointer;
  }
  .share-btn.whatsapp .ico{ width:18px; height:18px; fill:#fff; }
  .share-btn.whatsapp[disabled]{ opacity:.6; cursor:not-allowed; }
  .share-btn:hover{ transform:translateY(-1px); }

  /* Copiar link (fantasma) */
  .share-btn.ghost{
    display:inline-flex; align-items:center; gap:10px;
    background:transparent; color:#fff;
    border:2px solid #fff; border-radius:12px;
    padding:10px 14px; font-weight:800; cursor:pointer;
  }
  .share-btn.ghost .ico{ width:18px; height:18px; fill:#fff; }
  .share-btn[disabled]{ opacity:.6; cursor:not-allowed; }

  .toast{
    margin-top:12px; padding:12px 14px; border-radius:12px; background:#fff; color:var(--text);
    border-left:6px solid var(--icon); box-shadow:0 6px 18px rgba(0,0,0,.08);
    transform:translateY(8px); opacity:0; transition:opacity .25s ease, transform .25s ease; font-size:14px;
  }
  .toast.show{ transform:translateY(0); opacity:1; }

  .hidden{ display:none !important; }
</style>
</head>
<body>
  <div class="wrapper">
    <div class="panel">
      <!-- FORM -->
      <form id="invite-form" autocomplete="off" novalidate>
        <input type="text" name="nick" id="nick" style="display:none" tabindex="-1" autocomplete="off">
        <h2 class="title">Gerar meu link de indicaÃ§Ã£o</h2>
        <p class="subtitle">Insira seus dados abaixo para encontrar seu link de convite exclusivo.</p>

        <label class="label" for="cpf">CPF</label>
        <input class="input" id="cpf" name="cpf" inputmode="numeric" placeholder="000.000.000-00" required maxlength="14">

        <label class="label" for="phone">NÃºmero de Telefone</label>
        <input class="input" id="phone" name="phone" inputmode="numeric" placeholder="(22) 91234-5678" required maxlength="15">

        <button class="btn" type="submit" aria-label="Consultar">Gerar Link</button>
      </form>

      <!-- RESULTADO -->
      <section id="result" class="card hidden" aria-live="polite">
        <h3 class="card-title">Dados</h3>
        <div class="row"><span class="k">Cliente</span><span class="v" id="r-nome">â€”</span></div>
        <div class="row"><span class="k">Clicks</span><span class="v" id="r-clicks">â€”</span></div>
        <div class="row"><span class="k">Convidados</span><span class="v" id="r-convidados">â€”</span></div>
        <div class="row">
          <span class="k">Convite</span>
          <span class="v link-wrap"><a id="r-link" href="#" target="_blank" rel="noopener">abrir link</a></span>
        </div>

        <div class="share-ctas">
          <!-- WhatsApp verde -->
          <button id="share-whatsapp" class="share-btn whatsapp" type="button" disabled aria-disabled="true">
            <svg viewBox="0 0 24 24" class="ico" aria-hidden="true">
              <path d="M20.5 3.5A11 11 0 0 0 3.3 18.6L2 22l3.6-1.2A11 11 0 1 0 20.5 3.5Zm-8.5 17a9 9 0 0 1-4.6-1.3l-.3-.2-2.7.9.9-2.6-.2-.3a9 9 0 1 1 6.9 3.5Zm5-6.6c-.3-.2-1.6-.8-1.8-.9s-.4-.1-.6.1-.7.9-.9 1.1c-.2.2-.3.2-.6.1s-1.3-.5-2.4-1.5c-.9-.8-1.5-1.8-1.7-2.1s0-.5.1-.6l.5-.6c.1-.2.2-.3.3-.5.1-.2.1-.4 0-.5S9 6.8 8.8 6.3C8.6 6 8.4 6 8.2 6H7.7c-.2 0-.5.1-.7.3-.2.3-.9.9-.9 2.1s1 2.4 1.1 2.6c.1.2 2 3.1 5 4.3.7.3 1.2.5 1.7.6.7.2 1.3.2 1.7.1.5-.1 1.6-.6 1.8-1.2.2-.6.2-1.1.1-1.2s-.2-.2-.5-.4Z"/>
            </svg>
            Compartilhar no WhatsApp
          </button>

          <!-- Copiar link (fantasma) -->
          <button id="copy-link" class="share-btn ghost" type="button" disabled aria-disabled="true">
            <svg viewBox="0 0 24 24" class="ico" aria-hidden="true">
              <path d="M16 1H4a2 2 0 0 0-2 2v12h2V3h12V1Zm3 4H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm0 16H8V7h11v14Z"/>
            </svg>
            Copiar link
          </button>
        </div>
      </section>

      <section id="feedback" class="toast" hidden role="status" aria-live="polite"></section>
    </div>
  </div>

<script>
(function(){
  const $=s=>document.querySelector(s);
  const form=$("#invite-form"), toast=$("#feedback"), card=$("#result"),
        shareBtn=$("#share-whatsapp"), copyBtn=$("#copy-link");
  const out={nome:$("#r-nome"),clicks:$("#r-clicks"),convidados:$("#r-convidados"),link:$("#r-link")};

  const apiURL = window.location.origin + "/api/invite";
  const onlyDigits=s=>String(s||"").replace(/\D+/g,"");

  const cpf=$("#cpf"), phone=$("#phone");

  // MÃ¡scaras VISUAIS
  cpf.addEventListener("input", () => {
    let v = onlyDigits(cpf.value).slice(0,11);
    v = v.replace(/(\d{3})(\d)/, "$1.$2")
         .replace(/(\d{3})(\d)/, "$1.$2")
         .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
    cpf.value = v;
  });

  phone.addEventListener("input", () => {
    let v = onlyDigits(phone.value).slice(0,11);
    v = v.replace(/^(\d{2})(\d)/, "($1) $2")
         .replace(/(\d{5})(\d{4})$/, "$1-$2");
    phone.value = v;
  });

  function toastShow(msg, ok=false){
    toast.textContent = msg;
    toast.style.borderLeftColor = ok ? "#16a34a" : "#FF9000";
    toast.hidden = false;
    requestAnimationFrame(()=> toast.classList.add("show"));
    pingHeight();
  }
  function toastHide(){
    toast.classList.remove("show");
    setTimeout(()=>{ toast.hidden = true; toast.textContent = ""; pingHeight(); }, 250);
  }

  function disableShare(){ shareBtn.disabled=true; copyBtn.disabled=true; shareBtn.onclick=copyBtn.onclick=null; }
  function enableShare(link, nome){
    const text=`Oi! Esse Ã© o meu link de indicaÃ§Ã£o da Entre ðŸ’œ\n${nome?nome+" â€” ":""}${link}`;
    const encoded=encodeURIComponent(text);
    shareBtn.disabled=false; shareBtn.onclick=()=>window.open(`https://wa.me/?text=${encoded}`,"_blank","noopener");
    copyBtn.disabled=false; copyBtn.onclick=async()=>{ try{ await navigator.clipboard.writeText(link); toastShow("Link copiado!", true);} catch{ toastShow("NÃ£o foi possÃ­vel copiar automaticamente. Copie o link manualmente."); } };
  }

  function showResult(data){
    const nome=data?.cliente?.nome||"â€”";
    out.nome.textContent=nome;
    out.clicks.textContent=Number.isFinite(data?.cliente?.clicks)?data.cliente.clicks:"â€”";
    out.convidados.textContent=Number.isFinite(data?.convidados)?data.convidados:"â€”";

    const link=data?.convite;
    if(link){ out.link.href=link; out.link.textContent="abrir link"; enableShare(link,nome); }
    else{ out.link.removeAttribute("href"); out.link.textContent="â€”"; disableShare(); }

    form.classList.add("hidden");
    card.classList.remove("hidden");
    requestAnimationFrame(()=> { card.classList.add("visible"); pingHeight(); });
  }

  form.addEventListener("submit", async (e)=>{
    e.preventDefault(); toastHide(); card.classList.remove("visible"); disableShare();

    const cpfNum   = onlyDigits(cpf.value);
    const phoneNum = onlyDigits(phone.value);

    if (cpfNum.length !== 11)  return toastShow("CPF invÃ¡lido. Informe 11 dÃ­gitos.");
    if (phoneNum.length !== 11) return toastShow("Telefone invÃ¡lido. Informe DDD + 9 + nÃºmero (11 dÃ­gitos).");

    try{
      const resp = await fetch(apiURL, {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ cpf: cpfNum, phone: phoneNum, nick:"" })
      });
      const data = await resp.json();
      if(!resp.ok){
        const msg=(data?.error||"").includes("NÃ£o encontrado")
          ? "Telefone nÃ£o identificado. Confirme o nÃºmero informado ou entre em contato com nossa equipe para atualizar seu cadastro."
          : (data?.error || "Falha ao localizar. Confira os dados e tente novamente.");
        return toastShow(msg);
      }
      showResult(data);
      toastShow("Convite localizado com sucesso!", true);
    }catch{
      toastShow("Falha ao consultar. Tente novamente em instantes.");
    }
  });

  /* ===== Auto-altura do iFrame (Framer) ===== */
  function pingHeight(){
    try{
      const h = document.documentElement.scrollHeight || document.body.scrollHeight || 520;
      window.parent.postMessage({ type:"entre:height", height:h }, "*");
    }catch(_){}
  }
  window.addEventListener("load", pingHeight);
  window.addEventListener("resize", ()=> requestAnimationFrame(pingHeight));
})();
</script>
</body>
</html>
